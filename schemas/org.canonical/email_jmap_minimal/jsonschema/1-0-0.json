{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "JMAP Email (Minimal) - Metadata-Only Canonical Format",
  "description": "Minimal JMAP Email format with metadata only. Based on RFC 8621 but excludes body content inline. Use for: search indexes, analytics, high-volume processing, data warehouses. Includes all metadata (from/to, subject, dates, preview) but body content referenced by blobId for separate storage (S3, object store). Storage: ~1-5KB per email. Trade-off: Lowest storage cost but requires separate body retrieval.",
  "type": "object",
  "required": ["id", "threadId", "receivedAt"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique message identifier",
      "examples": ["18c5f2e8a9b4d7f3"]
    },
    "blobId": {
      "type": "string",
      "description": "Raw RFC5322 message octets identifier - use this to fetch full message body from blob storage",
      "examples": ["blob-18c5f2e8a9b4d7f3"]
    },
    "threadId": {
      "type": "string",
      "description": "Conversation/thread identifier",
      "examples": ["18c5f2e8a9b4d7f3"]
    },
    "messageId": {
      "type": ["array", "null"],
      "items": {"type": "string"},
      "description": "Message-ID header value(s)",
      "examples": [["<CABcD1E2FgH3@mail.company.com>"]]
    },
    "inReplyTo": {
      "type": ["array", "null"],
      "items": {"type": "string"},
      "description": "In-Reply-To header value(s)",
      "examples": [["<CAAbC9D8@mail.example.com>"]]
    },
    "references": {
      "type": ["array", "null"],
      "items": {"type": "string"},
      "description": "References header value(s) - message ID chain",
      "examples": [["<msg1@example.com>", "<msg2@example.com>"]]
    },
    "from": {
      "type": ["array", "null"],
      "items": {"$ref": "#/definitions/emailAddress"},
      "description": "Message sender(s)",
      "examples": [[{"name": "Sarah Smith", "email": "sarah.smith@company.com"}]]
    },
    "to": {
      "type": ["array", "null"],
      "items": {"$ref": "#/definitions/emailAddress"},
      "description": "Primary recipients"
    },
    "cc": {
      "type": ["array", "null"],
      "items": {"$ref": "#/definitions/emailAddress"},
      "description": "Carbon copy recipients"
    },
    "bcc": {
      "type": ["array", "null"],
      "items": {"$ref": "#/definitions/emailAddress"},
      "description": "Blind carbon copy recipients (rarely available)"
    },
    "replyTo": {
      "type": ["array", "null"],
      "items": {"$ref": "#/definitions/emailAddress"},
      "description": "Reply-To addresses"
    },
    "subject": {
      "type": ["string", "null"],
      "description": "Email subject",
      "examples": ["Follow-up: Q4 Report Request"]
    },
    "sentAt": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "When sender sent the message (ISO 8601)",
      "examples": ["2023-11-09T20:00:00Z"]
    },
    "receivedAt": {
      "type": "string",
      "format": "date-time",
      "description": "When message arrived at mail store (ISO 8601)",
      "examples": ["2023-11-09T20:00:15Z"]
    },
    "size": {
      "type": "integer",
      "description": "Size of complete raw message in bytes",
      "examples": [4521]
    },
    "preview": {
      "type": "string",
      "maxLength": 256,
      "description": "Plaintext preview/snippet (max 256 chars) - enough for search results",
      "examples": ["Hi John, Just wanted to follow up on our meeting yesterday..."]
    },
    "hasAttachment": {
      "type": "boolean",
      "description": "Indicates if message has attachments",
      "examples": [true]
    },
    "attachmentCount": {
      "type": "integer",
      "description": "Number of file attachments",
      "examples": [2]
    },
    "keywords": {
      "type": "object",
      "additionalProperties": {"type": "boolean"},
      "description": "IMAP keywords/flags. Standard: $seen, $flagged, $answered, $draft",
      "examples": [{"$seen": true, "$flagged": false}]
    },
    "labels": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Labels/folders (INBOX, SENT, custom labels)",
      "examples": [["INBOX", "IMPORTANT", "Work"]]
    },
    "importance": {
      "type": "string",
      "enum": ["low", "normal", "high"],
      "description": "Message importance/priority",
      "examples": ["normal"]
    }
  },
  "definitions": {
    "emailAddress": {
      "type": "object",
      "description": "Email address with optional display name",
      "properties": {
        "name": {
          "type": ["string", "null"],
          "description": "Display name",
          "examples": ["John Doe"]
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email address",
          "examples": ["john@example.com"]
        }
      },
      "required": ["email"]
    }
  }
}
